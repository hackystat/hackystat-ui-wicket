<project name="jar" default="jar">
  <description>
  Provides the target for building a jar file of the ProjectBrowser.
  </description>

  <import file="build.xml"/>
  <property name="tmp.dir" location="${basedir}/tmp" />
  <property name="tmp.lib.dir" location="${basedir}/tmp-lib" />
 
  <target name="jar" depends="compile" 
    description="Create projectbrowser.jar">
    <!-- Define the directories and distribution name -->
    <delete dir="${tmp.dir}" quiet="yes"/>
    <mkdir dir="${tmp.dir}" />
    
    <!-- Copy the projectbrowser files over. -->
    <copy todir="${tmp.dir}">
      <fileset dir="${basedir}/build/classes"/>
    </copy>
    
    <!-- Copy over all of the required libraries. --> 
    <unjar dest="${tmp.dir}">
      <fileset file="${env.HACKYSTAT_SENSORBASE_HOME}/sensorbase.jar" />
      <fileset file="${env.HACKYSTAT_DAILYPROJECTDATA_HOME}/dailyprojectdata.lib.jar" />
      <fileset file="${env.HACKYSTAT_TELEMETRY_HOME}/telemetry.jar" />
      <fileset dir="${env.WICKET_HOME}/lib">
        <include name="wicket-${wicket.version}.jar" />
        <include name="wicket-datetime-${wicket.version}.jar" />
        <include name="wicket-extensions-${wicket.version}.jar" />
      </fileset>
      <fileset dir="${env.JETTY_HOME}/lib">
         <include name="jetty-${jetty.version}.jar" />
         <include name="jetty-util-${jetty.version}.jar" />
         <include name="servlet-api-2.5-${jetty.version}.jar" />
       </fileset>
       <fileset dir="${env.SLF4J_HOME}">
         <include name="slf4j-api-${slf4j.version}.jar" />
         <include name="slf4j-simple-${slf4j.version}.jar" />
       </fileset>
    </unjar>

    <jar destfile="${basedir}/projectbrowser.jar" basedir="${tmp.dir}">
       <manifest>
         <attribute name="Main-Class" value="org.hackystat.projectbrowser.Start"/>
         <attribute name="Implementation-Title" value="Hackystat ProjectBrowser"/>
         <attribute name="Implementation-Version" value="${version}"/>
         <attribute name="Implementation-Vendor" value="Collaborative Software Development Laboratory, University of Hawaii"/>
       </manifest>
     </jar>
      <delete dir="${tmp.dir}" />
  </target>     
</project>

